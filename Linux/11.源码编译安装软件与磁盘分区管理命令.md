开源源代码获取方式：http://apache.org/

编译源码的项目工具：

+ C、C++ 的源码编译：使用make项目管理器

  configure脚本 --> Makefile.in -- > Makefile

  相关开发工具：

  autoconf:生成configure脚本

  automake:生成Makefile.in

+ Java的源码编译，使用maven

## C语言源代码编译安装过程

利用编译工具，通常只需要三个大步骤

+ ./configure

  (1)通过选项传递参数，指定安装路径，启用特性等；执行时会参考用户的指定以及Makefile.in文件生成Makefile

  (2)检查依赖到的外部环境，如依赖的软件包

+ make 根据Makefile文件，构建应用程序
+ make install 复制文件到相应路径

注意：安装前可以通过查看README，INSTALL获取帮助

#### 编译安装准备

准备：安装相关的依赖包

+ 开发工具：make，gcc(c/c++编译器GNU C Complier)
+ 开发环境：开发库（glibc：标准库），头文件，可安装开发包组Development Tools
+ 特定软件相关依赖包

生产实践：基于最小化安装的系统建议安装下面相关包

```
yum install gcc make gcc-c++ glibc glibc-devel pcre pcre-devel openssl openssl-devel systemd-devel zlib-devel vim lrzsz tree tmux lsof tcpdump wget net-tools iotop bc bzip2 zip unzip nfs-utils man-pages
```

#### 编译安装

第一步：运行 configure脚本，生成Makefile文件

其选项主要功能：

+ 可以指定安装位置
+ 指定启用的特性

获取其支持使用的选项

```
./configure --help
```

选项分类：

+ 安装路径设定：

  + --prefix=/PATH:指定默认安装位置，默认为/usr/local/

  + --sysconfdir=/PATH:配置文件安装位置

    System types：支持交叉编译

+ 软件特性和相关指定：

  Optional Features：可选特性

  ​	--disable-FEATURE

  ​	--enable-FEATURE[=ARG]

  Optional Packages:可选包

  ​	--with-PACKAGE[=ARG] 依赖包

  ​	--widthout-PACKAGE 禁用依赖关系

  注意：通常编译操作以来的程序包，需要安装此程序报的开发“组件”，其包名一般类似于name-devel-VERSION

第二步：make

第三步：make install

#### 安装后的配置

​	1.二进制程序目录导入至PATH环境变量中

​		编辑文件/etc/profile.d/NAME.sh

```
export PATH=/PATH/TO/BIN:$PATH
```

​	2.相关用户及文件

​		有些开源软件编译完成后，还需要创建相关的用户及文件

​	3.导入帮助手册

​		编辑/etc/man.config|man_db.conf文件，添加一个MANPATH

​	范例：编译安装tree1.8

```bash
#1 安装相关的依赖包
[root@centos7: ~]yum install gcc make

#2 下载源码并解压
[root@centos7: src]tar -zxvf tree-1.8.0.tgz

#3 进入解压缩的目录，查看README和INSTALL
[root@centos7: src]cd tree-1.8.0
[root@centos7: tree-1.8.0]cat README
[root@centos7: tree-1.8.0]cat INSTALL

#4 修改源码的版本号
[root@centos7: tree-1.8.0]#grep -R 'v1\.8\.0' *
tree.c:static char *version ="$Version: $ tree v1.8.0 (c) 1996 - 2018 by Steve Baker, Thomas Moore, Francesc Rocher, Florian Sesser, Kyosuke Tokoro $";
tree.c:static char *hversion="\t\t tree v1.8.0 %s 1996 - 2018 by Steve Baker and Thomas Moore <br>\n"

[root@centos7: tree-1.8.0]sed -i 's#v1\.8\.0#v.18.0#' tree.c

#5 编译准备
[root@centos7: tree-1.8.0]vim Makefile
prefix=/apps/tree

#6 编译
[root@centos7: tree-1.8.0]make

#7 安装
[root@centos7: tree-1.8.0]make install

#8 修改PATH变量
[root@centos7: tree-1.8.0]echo 'PATH=/apps/tree/bin:$PATH' > /etc/profile.d/tree.sh
. /etc/profile.d/tree.sh

#9 验证
[root@centos7: tree-1.8.0]tree --version
```

范例：编译安装cmatrix

```bash
#1 下载cmatrix压缩包，解压进入目录
[root@centos7: src]#wget https://www.asty.org/cmatrix2/dist/cmatrix-1.2a.tar.gz
[root@centos7: src]#tar xvf cmatrix-1.2a.tar.gz
[root@centos7: src]#cd cmatrix-1.2a/

#2 执行./configure make make install 进行安装
[root@centos7: cmatrix-1.2a]#./configure --prefix=/apps/cmatrix
[root@centos7: cmatrix-1.2a]#make
[root@centos7: cmatrix-1.2a]#make install
## 注意：如果./configure未提示库未安装，在make时提示需要头文件(*.h),使用yum list *name* 来搜索，然后安装name-devel的开发包，然后重新解压编译安装

#3 添加到环境变量PATH中
[root@centos7: cmatrix-1.2a]#echo 'PATH=/apps/cmtrix/bin:$PATH' > /etc/profile.d/cmtrix.sh
[root@centos7: cmatrix-1.2a]#. /etc/profile.d/cmtrix.sh

#4 测试
[root@centos7: profile.d]#cmatrix
```

范例：编译安装httpd

```bash
# 下载，解压,进入目录
[root@centos7: src]#wget https://downloads.apache.org//httpd/httpd-2.4.41.tar.bz2
[root@centos7: src]#tar xjfv  httpd-2.4.41.tar.bz2
[root@centos7: src]#cd httpd-2.4.41/

# 查看README，INSTALL文档
[root@centos7: httpd-2.4.41]#cat README
[root@centos7: httpd-2.4.41]#cat INSTALL

# 查看软件特性：
##Optional Features:--disable-FEATURE(默认是开启的特性，编译时加上参数关闭该特性)；--enable-FEATURE[=ARG](默认是关闭的，编译时加上参数开启该特性)
[root@centos7: httpd-2.4.41]#./configure --help

# 编译安装
[root@centos7: httpd-2.4.41]#./configure --prefix=/apps/http24 --sysconfdir=/etc/httpd24 --enable-so --enable-ssl
checking for chosen layout... Apache
checking for working mkdir -p... yes
checking for grep that handles long lines and -e... /usr/bin/grep
checking for egrep... /usr/bin/grep -E
checking build system type... x86_64-pc-linux-gnu
checking host system type... x86_64-pc-linux-gnu
checking target system type... x86_64-pc-linux-gnu
configure: 
configure: Configuring Apache Portable Runtime library...
configure: 
checking for APR... no
configure: error: APR not found.  Please read the documentation.

# 报错 error: APR not found，查询apr包（只列apr未装的包）
[root@centos7: httpd-2.4.41]#yum list  available "*apr*"
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
Available Packages
apr-devel.x86_64                                 1.4.8-3.el7_4.1                   cd  
apr-util-devel.x86_64                            1.5.2-6.el7                       cd  
haproxy.x86_64                                   1.5.18-8.el7                      cd  
libapreq2.x86_64                                 2.13-13.el7                       base
libapreq2-devel.x86_64                           2.13-13.el7                       base
libchromaprint.x86_64                            1.0-1.el7                         base
libchromaprint-devel.x86_64                      1.0-1.el7                         base
perl-libapreq2.x86_64                            2.13-13.el7                       base
php-whitehat101-apr1-md5.noarch                  1.0.0-1.el7                       base
snapraid.x86_64                                  10.0-1.el7                        base
# 安装
[root@centos7: httpd-2.4.41]#yum install apr-devel.x86_64

# 第二次编译
[root@centos7: httpd-2.4.41]#./configure --prefix=/apps/http24 --sysconfdir=/etc/httpd24 --enable-so --enable-ssl
......
checking for APR-util... no
configure: error: APR-util not found.  Please read the documentation.

[root@centos7: httpd-2.4.41]#yum list  available "*apr*"
[root@centos7: httpd-2.4.41]#yum install apr-util-devel.x86_64
Error: Package: openldap-devel-2.4.44-20.el7.x86_64 (cd)
           Requires: openldap(x86-64) = 2.4.44-20.el7
           Installed: openldap-2.4.44-21.el7_6.x86_64 (@base)
               openldap(x86-64) = 2.4.44-21.el7_6
           Available: openldap-2.4.44-20.el7.x86_64 (cd)
               openldap(x86-64) = 2.4.44-20.el7
Error: Package: libdb-devel-5.3.21-24.el7.x86_64 (cd)
           Requires: libdb(x86-64) = 5.3.21-24.el7
           Installed: libdb-5.3.21-25.el7.x86_64 (@base)
               libdb(x86-64) = 5.3.21-25.el7
           Available: libdb-5.3.21-24.el7.x86_64 (cd)
               libdb(x86-64) = 5.3.21-24.el7
 You could try using --skip-broken to work around the problem
** Found 2 pre-existing rpmdb problem(s), 'yum check' output follows:
icedtea-web-1.7.1-1.el7.x86_64 has missing requires of java-1.8.0-openjdk
jline-1.0-8.el7.noarch has missing requires of java >= ('0', '1.5', None)


```







