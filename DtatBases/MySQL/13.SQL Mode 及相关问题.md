# SQL Mode 及相关问题

​		与其他数据库不同，MySQL 可以运行在不同的 SQL Mode （SQL 模式）下。SQL Mode 定义了MySQL 应用支持的SQL语法、数据校验等，这样可以更容易地在不同地环境中使用MySQL。

## MySQL SQL Mode 简介

​		在MySQL中，SQL Mode 常用来解决以下几类问题：

1. 通过SQL Mode，可以完成不同严格程度的数据校验，有效地保证数据准确性。
2. 通过设置 SQL Mode 为 ANSI 模式，来保证大多数SQL符合标准地SQL语法，这样应用在不同的数据库之间进行迁移时，则不需要对业务SQL进行较大地修改。
3. 在不同数据库之间进行数据迁移之前，通过设置SQL Mode 可以使MySQL上的数据更方便地迁移到目标数据库中，

在MySQL5.7中，SQL Mode 有了较大的变化，查询默认地SQL Mode（sql_mode 参数）为ONLY_FULL_GROUP_BY、STRICT_TRANS_TABLES、NO_ZERO_IN_DATE、NO_ZERO_DATE、ERROR_FOR_DIVISION_BY_ZERO、NO_AUTO_CREATE_USER 和 NO_ENGINE_SUBSTITUTION (不同的小版本可能略有差异)。这些SQL Mode 含义如下：

| sql_mode 的值              | 描述                                                         |
| -------------------------- | ------------------------------------------------------------ |
| ONLY_FULL_GROUP_BY         | 在 group by 子句中没有出现的列，出现在select 列表、having 条件，order by 条件中时会被拒绝。 |
| STRICT_TRANS_TABLES        | 非法日期，超过字段长度的值插入时，直接报错，拒绝执行         |
| NO_ZERO_IN_DATE            | 日期中针对月份和日期部分，如果为0，比如‘2018-00-00’，有不同的执行逻辑<br />1. disable：可以正常插入，实际插入值还是‘2018-00-00’ 没有警告<br />2. enable：可以正常插入，有警告；如果mode中包含 STRICT_TRANS_TABLES,则日期被拒绝写入，但可以通过ignore 关键字写入‘0000-00-00’； |
| NO_ZERO_DATE               | 针对日期‘0000-00-00’，执行逻辑如下：<br />1. disable：可以正常插入，没有警告<br />2. enable：可以正常插入，有警告；如果mode中包含STRICT_TRANS_TABLES,则日期拒绝被写入，但可以通过关键字 ignore 写入 ‘0000-00-00’，有警告。 |
| ERROR_FOR_DIVISION_BY_ZERO | 除数为0（包括MOD(N,0)）,执行逻辑如下：<br />1. disable：插入NULL，没有警告<br />2. enable：插入NULL，有警告；如果mode中包含STRICT_TRANS_TABLES,则数据被拒绝写入，但可以通过加关键字 ignore 写入NULL，有警告。 |
| NO_AUTO_CREATE_USER        | 防止使用不带密码子句的grant 语句来创建一个用户。             |
| NO_ENGINE_SUBSTITUTION     | 执行create table 或者alter table语句时，如果指定了不支持（包括 disable 或未编译）的存储引擎，是否自动替换为默认的存储引擎<br />1. disable：create table 会自动替换后执行，alter table 不会执行，两个命令都有警告<br />2. enable：两个命令直接报错 |

​		相比之前的版本，MySQL5.7.5 之后的版本最大的区别是在 SQL Mode的默认设置中，增加了严格的事物表模式（STRICT_TRANS_TABLES）,在这种模式下不允许插入字段类型不一致的值，不允许插入超过字段长度的值，这在绝大多数场景下都更加合理。如果不设置STRICT_TRANS_TABLES，那么上述操作会被允许，只是在插入后，MySQL会返回一个warning，从而导致表中写入异常数据。